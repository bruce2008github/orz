===
orz
===

Porting programming languages to CPython VM.

There is only an experimental partial implementation of `Lua 5.2`_
right now.  You can try it out with following commands.


.. code-block:: console

    $ pip install git+git://github.com/xiazheteng/orz
    $ cat > hello.lua << EOF
    print(_VERSION)
    EOF
    $ python -m orz.lua hello.lua
    Lua 5.2
    $



Lua 5.2
=======



Language Features
-----------------

Most Lua language features are missing.

+-----------------------+----------------------------+
| GC Metamethod         | No                         |
+-----------------------+----------------------------+
| Weak Table            | No                         |
+-----------------------+----------------------------+
| Coroutine             | No                         |
+-----------------------+----------------------------+
| goto statement        | Partial                    |
+-----------------------+----------------------------+
| proper tail recursion | No                         |
+-----------------------+----------------------------+



Libraries
---------

Only a small subset of Lua Standard Libraries are implemented.

+-----------------------+----------------------------+
| `Basic Library`_      | Partial                    |
+-----------------------+----------------------------+
| Coroutine             | No                         |
+-----------------------+----------------------------+
| `Package Library`_    | Partial                    |
+-----------------------+----------------------------+
| `String Library`_     | Partial                    |
+-----------------------+----------------------------+
| Table                 | Yes                        |
+-----------------------+----------------------------+
| Math                  | Bug, see `Number`_         |
+-----------------------+----------------------------+
| Bit32                 | No                         |
+-----------------------+----------------------------+
| `I/O Library`_        | Partial                    |
+-----------------------+----------------------------+
| `OS Library`_         | Partial                    |
+-----------------------+----------------------------+
| Debug                 | No                         |
+-----------------------+----------------------------+



Basic Library
~~~~~~~~~~~~~

+-----------------------+----------------------------+
| assert                | Yes                        |
+-----------------------+----------------------------+
| collectgarbage        | No                         |
+-----------------------+----------------------------+
| dofile                | No                         |
+-----------------------+----------------------------+
| error                 | Partial                    |
+-----------------------+----------------------------+
| _G                    | Partial                    |
+-----------------------+----------------------------+
| getmetatable          | Yes                        |
+-----------------------+----------------------------+
| ipairs                | Yes                        |
+-----------------------+----------------------------+
| load                  | Different\ [#load]_        |
+-----------------------+----------------------------+
| loadfile              | Different\ [#load]_        |
+-----------------------+----------------------------+
| next                  | No                         |
+-----------------------+----------------------------+
| pairs                 | No                         |
+-----------------------+----------------------------+
| pcall                 | No                         |
+-----------------------+----------------------------+
| print                 | Bug                        |
+-----------------------+----------------------------+
| rawequal              | Yes                        |
+-----------------------+----------------------------+
| rawget                | Yes                        |
+-----------------------+----------------------------+
| rawlen                | Yes                        |
+-----------------------+----------------------------+
| rawset                | Yes                        |
+-----------------------+----------------------------+
| select                | Yes                        |
+-----------------------+----------------------------+
| setmetatable          | Yes                        |
+-----------------------+----------------------------+
| tonumber              | Bug, see `tonumber`_       |
+-----------------------+----------------------------+
| tostring              | Yes                        |
+-----------------------+----------------------------+
| type                  | No                         |
+-----------------------+----------------------------+
| _VERSION              | Yes                        |
+-----------------------+----------------------------+
| xpcall                | No                         |
+-----------------------+----------------------------+



Package Library
~~~~~~~~~~~~~~~

+-----------------------+----------------------------+
| require               | Partial                    |
+-----------------------+----------------------------+
| package.config        | No                         |
+-----------------------+----------------------------+
| package.cpath         | No                         |
+-----------------------+----------------------------+
| package.loaded        | No                         |
+-----------------------+----------------------------+
| package.loadlib       | No                         |
+-----------------------+----------------------------+
| package.path          | No                         |
+-----------------------+----------------------------+
| package.preload       | No                         |
+-----------------------+----------------------------+
| package.searchers     | No                         |
+-----------------------+----------------------------+
| package.searchpath    | No                         |
+-----------------------+----------------------------+



String Library
~~~~~~~~~~~~~~

+-----------------------+----------------------------+
| string.byte           | Yes                        |
+-----------------------+----------------------------+
| string.char           | Yes                        |
+-----------------------+----------------------------+
| string.dump           | No                         |
+-----------------------+----------------------------+
| string.find           | No                         |
+-----------------------+----------------------------+
| string.format         | Bug, see `Format`_         |
+-----------------------+----------------------------+
| string.gmatch         | Different\ [#patterns]_    |
+-----------------------+----------------------------+
| string.gsub           | Different\ [#patterns]_    |
+-----------------------+----------------------------+
| string.len            | Yes                        |
+-----------------------+----------------------------+
| string.lower          | Yes                        |
+-----------------------+----------------------------+
| string.match          | Different\ [#patterns]_    |
+-----------------------+----------------------------+
| string.rep            | Yes                        |
+-----------------------+----------------------------+
| string.reverse        | Yes                        |
+-----------------------+----------------------------+
| string.sub            | Yes                        |
+-----------------------+----------------------------+
| string.upper          | Yes                        |
+-----------------------+----------------------------+



I/O Library
~~~~~~~~~~~

+-----------------------+----------------------------+
| io.close              | Partial                    |
+-----------------------+----------------------------+
| io.flush              | Yes                        |
+-----------------------+----------------------------+
| io.input              | Yes                        |
+-----------------------+----------------------------+
| io.lines              | No                         |
+-----------------------+----------------------------+
| io.open               | Yes                        |
+-----------------------+----------------------------+
| io.output             | Yes                        |
+-----------------------+----------------------------+
| io.popen              | No                         |
+-----------------------+----------------------------+
| io.read               | Partial                    |
+-----------------------+----------------------------+
| io.tmpfile            | Yes                        |
+-----------------------+----------------------------+
| io.type               | Yes                        |
+-----------------------+----------------------------+
| io.write              | Yes                        |
+-----------------------+----------------------------+
| file\:close           | Partial                    |
+-----------------------+----------------------------+
| file\:flush           | Yes                        |
+-----------------------+----------------------------+
| file\:lines           | No                         |
+-----------------------+----------------------------+
| file\:read            | Partial                    |
+-----------------------+----------------------------+
| file\:seek            | Yes                        |
+-----------------------+----------------------------+
| file\:setvbuf         | No                         |
+-----------------------+----------------------------+
| file\:write           | Yes                        |
+-----------------------+----------------------------+



OS Library
~~~~~~~~~~

+-----------------------+----------------------------+
| os.clock              | Yes                        |
+-----------------------+----------------------------+
| os.date               | Yes                        |
+-----------------------+----------------------------+
| os.difftime           | Yes                        |
+-----------------------+----------------------------+
| os.execute            | Yes                        |
+-----------------------+----------------------------+
| os.exit               | Partial                    |
+-----------------------+----------------------------+
| os.getenv             | Yes                        |
+-----------------------+----------------------------+
| os.remove             | Yes                        |
+-----------------------+----------------------------+
| os.rename             | Yes                        |
+-----------------------+----------------------------+
| os.setlocale          | No                         |
+-----------------------+----------------------------+
| os.time               | Yes                        |
+-----------------------+----------------------------+
| os.tmpname            | No                         |
+-----------------------+----------------------------+



Known Bugs
----------


Number
~~~~~~

All ``ValueError`` are converted to ``nan``, and all ``OverflowError``
are converted to ``inf``.


tonumber
~~~~~~~~

The convertion of fraction part of hexadecimal constants may overflow.


Format
~~~~~~

`string.format` is simply equivalent to ``formatstring%...`` in
Python, now.



_ENV
~~~~

The following program, Lua 5.2.1 displays `1`, but orz.lua displays
`nil`.

.. code-block:: lua

    a = 0

    function x()
        _ENV = {print=print}
        return 1
    end

    _ENV["a"] = x()

    print(a)


.. rubric:: Footnotes

.. [#load]
    load does not accept Lua chunks in binary mode but marshaled
    Python code objects instead. And the second argument of load is
    changed to filename

.. [#patterns]
    Currently, patterns are just Python regular expressions.
